

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Episode Photos</title>
    <style>
        body {
          font-family: Arial, sans-serif;
          background: #f0f2f5;
          margin: 0;
          padding: 0;
        }

        .topbar {
          background-color: #3f51b5;
          color: white;
          padding: 15px 20px;
          font-size: 20px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .topbar button {
          background-color: white;
          color: #3f51b5;
          border: none;
          padding: 8px 12px;
          border-radius: 6px;
          font-size: 14px;
          cursor: pointer;
        }

        .topbar button:hover {
          background-color: #e0e0e0;
        }

        .container {
          display: flex;
          flex-wrap: wrap;
          gap: 15px;
          justify-content: center;
          padding: 20px;
        }

        .photo-thumb {
          width: 250px;
          height: 180px;
          object-fit: cover;
          border-radius: 10px;
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
          cursor: pointer;
          transition: transform 0.2s ease-in-out;
        }

        .photo-thumb:hover {
          transform: scale(1.03);
        }

        .message {
          text-align: center;
          margin-top: 30px;
          font-weight: bold;
          color: red;
        }

        /* Lightbox */
<!--        .lightbox {-->
<!--          position: fixed;-->
<!--          top: 0; left: 0;-->
<!--          width: 100%; height: 100%;-->
<!--          background: rgba(0,0,0,0.8);-->
<!--          display: none;-->
<!--          justify-content: center;-->
<!--          align-items: center;-->
<!--          z-index: 9999;-->
<!--          padding: 20px;-->
<!--          box-sizing: border-box;-->
<!--        }-->

<!--&lt;!&ndash;        .lightbox img {&ndash;&gt;-->
<!--&lt;!&ndash;          max-width: 90%;&ndash;&gt;-->
<!--&lt;!&ndash;          max-height: 90%;&ndash;&gt;-->
<!--&lt;!&ndash;          border-radius: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--        .lightbox-content {-->
<!--          display: flex;-->
<!--          flex-direction: column;-->
<!--          align-items: center;-->
<!--          max-height: 90%;-->
<!--          max-width: 90%;-->
<!--        }-->
<!--        .lightbox img {-->
<!--          max-height: 80vh;-->
<!--          max-width: 90vw;-->
<!--          object-fit: contain;-->
<!--          border-radius: 12px;-->
<!--        }-->
<!--        #photoCounter {-->
<!--          color: white;-->
<!--          font-size: 18px;-->
<!--          margin-top: 10px;-->
<!--        }-->
<!--        .nav-btn {-->
<!--          position: absolute;-->
<!--          top: 50%;-->
<!--          transform: translateY(-50%);-->
<!--          background: white;-->
<!--          color: black;-->
<!--          border: none;-->
<!--          font-size: 18px;-->
<!--          padding: 8px 14px;-->
<!--          cursor: pointer;-->
<!--          border-radius: 6px;-->
<!--        }-->

<!--        .nav-left {-->
<!--          left: 30px;-->
<!--        }-->

<!--        .nav-right {-->
<!--          right: 30px;-->
<!--        }-->

<!--        .close-btn {-->
<!--          position: absolute;-->
<!--          top: 20px;-->
<!--          right: 30px;-->
<!--          background: red;-->
<!--          color: white;-->
<!--          border: none;-->
<!--          padding: 8px 12px;-->
<!--          border-radius: 6px;-->
<!--          cursor: pointer;-->
<!--        }-->

    .lightbox {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.9);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  overflow: hidden;
}

.lightbox-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100%;
  width: 100%;
  justify-content: center;
}

.lightbox img {
  height: calc(100vh - 100px); /* take nearly full height */
  width: auto;
  max-width: 95vw;
  object-fit: contain;
  border-radius: 12px;
}

#photoCounter {
  color: white;
  font-size: 18px;
  margin-top: 10px;
}

/* Nav + Close Buttons */
.nav-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: white;
  color: black;
  border: none;
  font-size: 18px;
  padding: 8px 14px;
  cursor: pointer;
  border-radius: 6px;
}

.nav-left {
  left: 30px;
}

.nav-right {
  right: 30px;
}

.close-btn {
  position: absolute;
  top: 20px;
  right: 30px;
  background: red;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}

    </style>
</head>
<body>

<div class="topbar">
    <span>ðŸ“· Episode Photos</span>
    <div>
        <button onclick="goBackToEpisodes()">ðŸ”™ Back to Episodes</button>
        <button onclick="goToAddPhoto()">âž• Add Photo</button>
    </div>
</div>

<div class="container" id="photoContainer"></div>
<div class="message" id="message"></div>

<!-- Lightbox -->
<!--<div class="lightbox" id="lightbox">-->
<!--    <button class="close-btn" onclick="closeLightbox()">âœ–</button>-->
<!--    <button class="nav-btn nav-left" onclick="navigate(-1)">â¬…</button>-->
<!--    <img id="lightboxImg" src="" alt="Full Photo">-->
<!--    <div id="photoCounter"></div>-->
<!--    <button class="nav-btn nav-right" onclick="navigate(1)">âž¡</button>-->
<!--</div>-->

<div class="lightbox" id="lightbox">
    <button class="close-btn" onclick="closeLightbox()">âœ–</button>

    <div class="lightbox-content">
        <img id="lightboxImg" src="" alt="Full Photo">
        <div id="photoCounter"></div>
    </div>

    <button class="nav-btn nav-left" onclick="navigate(-1)">â¬…</button>
    <button class="nav-btn nav-right" onclick="navigate(1)">âž¡</button>
</div>

<script>
    const photoList = [];
    let currentIndex = 0;

    function getTokenFromCookie() {
      const match = document.cookie.match(/(^| )Authorization=([^;]+)/);
      return match ? decodeURIComponent(match[2]) : null;
    }

    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    function photoUrl(filename) {
      return `http://${window.location.host}/get_photo_from_url?url=${encodeURIComponent(filename)}`;
    }

    function fetchPhotos() {
      const token = getTokenFromCookie();
      const episodeId = getQueryParam("episodeId");

      if (!token || !episodeId) {
        document.getElementById("message").textContent = "Missing token or episode ID.";
        return;
      }

      fetch(`http://${window.location.host}/show_photos?episodeId=${episodeId}`, {
        headers: {
          "Authorization": token
        }
      })
      .then(res => {
        if (!res.ok) throw new Error("Failed to load photos");
        return res.json();
      })
      .then(photos => {
        const container = document.getElementById("photoContainer");
        container.innerHTML = "";

        if (!photos || photos.length === 0) {
          document.getElementById("message").textContent = "No photos found.";
          return;
        }

        photos.forEach((photo, index) => {
          photoList.push(photo);

          const img = document.createElement("img");
          img.className = "photo-thumb";
          img.src = photoUrl(photo.photoUrl);  // this is the `photo_url`
          img.alt = "Episode Photo";
          img.onclick = () => openLightbox(index);

          container.appendChild(img);
        });
      })
      .catch(err => {
        document.getElementById("message").textContent = err.message;
      });
    }

    function openLightbox(index) {
      currentIndex = index;
<!--      document.getElementById("lightboxImg").src = photoUrl(photoList[index].photoUrl);-->
      updateLightbox();
      document.getElementById("lightbox").style.display = "flex";
    }
    function updateLightbox() {
      const total = photoList.length;
      const photo = photoList[currentIndex];
      document.getElementById("lightboxImg").src = photoUrl(photo.photoUrl);
      document.getElementById("photoCounter").textContent = `${currentIndex + 1} / ${total}`;
    }

    function closeLightbox() {
      document.getElementById("lightbox").style.display = "none";
    }

    function navigate(step) {
      currentIndex += step;
      if (currentIndex < 0) currentIndex = photoList.length - 1;
      else if (currentIndex >= photoList.length) currentIndex = 0;
      updateLightbox();
<!--      document.getElementById("lightboxImg").src = photoUrl(photoList[currentIndex].photoUrl);-->
    }

    function goBackToEpisodes() {
      const memoryId = sessionStorage.getItem("currentMemoryId");
      if (memoryId) {
        window.location.href = `/frontend/show_episodes.html?memoryId=${memoryId}`;
      }
    }

    function goToAddPhoto() {
      const episodeId = getQueryParam("episodeId");
      if (episodeId) {
        window.location.href = `/frontend/add_photo.html?episodeId=${episodeId}`;
      }
    }

    window.onload = fetchPhotos;
</script>

</body>
</html>
