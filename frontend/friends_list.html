<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Friends</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f2f5;
            margin: 0;
            padding: 0;
        }

        .topbar {
            background-color: #3f51b5;
            color: white;
            padding: 15px 20px;
            font-size: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .topbar .title {
            font-weight: bold;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }

        .friends-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: #f5f5f5;
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
        }

        .friend-card {
            display: flex;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .friend-card:last-child {
            border-bottom: none;
        }

        .friend-info {
            flex-grow: 1;
        }

        .friend-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .friend-username {
            color: #666;
            font-size: 14px;
        }

        .friend-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .view-profile-btn {
            background-color: #2196f3;
            color: white;
        }

        .view-profile-btn:hover {
            background-color: #1976d2;
        }

        .no-friends {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .back-btn {
            background-color: #666;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .back-btn:hover {
            background-color: #555;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="topbar">
        <div class="title">CringeBook - My Friends</div>
        <div>
            <a href="show_memory.html" class="back-btn">Back to Home</a>
        </div>
    </div>

    <div class="container">
        <div class="friends-container">
            <div class="section-header">
                <h2 class="section-title">My Friends</h2>
            </div>
            <div id="loadingMessage" class="loading">Loading friends...</div>
            <div id="errorMessage" class="error" style="display: none;">Error loading friends</div>
            <div id="friendsList"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadFriends();
        });

        function getTokenFromCookie() {
            const match = document.cookie.match(/(^| )Authorization=([^;]+)/);
            return match ? decodeURIComponent(match[2]) : null;
        }

        async function loadFriends() {
            const token = getTokenFromCookie();
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const response = await fetch('/api/friends/list', {
                    method: 'GET',
                    headers: {
                        'Authorization': token
                    }
                });

                if (response.ok) {
                    const friends = await response.json();
                    displayFriends(friends);
                } else if (response.status === 401) {
                    window.location.href = 'login.html';
                } else {
                    showError('Error loading friends');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('Error loading friends');
            }
        }

        function displayFriends(friends) {
            const loadingMessage = document.getElementById('loadingMessage');
            const friendsList = document.getElementById('friendsList');
            
            loadingMessage.style.display = 'none';

            if (friends.length === 0) {
                friendsList.innerHTML = '<div class="no-friends">You don\'t have any friends yet. Start by searching for users!</div>';
                return;
            }

            let html = '';
            friends.forEach(friend => {
                html += `
                    <div class="friend-card">
                        <div class="friend-info">
                            <div class="friend-name">${escapeHtml(friend.name)}</div>
                            <div class="friend-username">@${escapeHtml(friend.userName)}</div>
                        </div>
                        <div class="friend-actions">
                            <button class="action-btn view-profile-btn" onclick="viewProfile(${friend.userID})">
                                View Profile
                            </button>
                        </div>
                    </div>
                `;
            });
            friendsList.innerHTML = html;
        }

        function viewProfile(userId) {
            window.location.href = `user_profile.html?userId=${userId}`;
        }

        function showError(message) {
            document.getElementById('loadingMessage').style.display = 'none';
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>